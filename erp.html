<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cookie Store - Painel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            dark: {
              900: '#0a0a0a',
              800: '#1a1a1a',
              700: '#2a2a2a',
              600: '#3a3a3a',
            }
          }
        }
      }
    }
  </script>
</head>
<body class="bg-dark-900 text-gray-200">

  <!-- Layout -->
  <div class="min-h-screen">
    <!-- Header -->
    <header class="bg-dark-800 shadow-sm">
      <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
        <h1 class="text-xl font-bold">
          <span class="text-2xl">游꼵</span> Cookie Store
        </h1>
        <div class="flex items-center space-x-4">
          <span class="text-sm text-gray-400">admin@cookiestore.com</span>
          <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center">
            <i class="fas fa-user text-sm"></i>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-6">
      <h2 class="text-2xl font-bold mb-6">Vis칚o Geral</h2>

      <!-- Cards Resumo -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <div class="bg-dark-700 p-4 rounded-lg border border-dark-600 hover:border-blue-500 transition-colors">
          <p class="text-sm text-gray-400">Pedidos Hoje</p>
          <p class="text-2xl font-bold">24</p>
        </div>
        <div class="bg-dark-700 p-4 rounded-lg border border-dark-600 hover:border-green-500 transition-colors">
          <p class="text-sm text-gray-400">Receita</p>
          <p class="text-2xl font-bold">R$ 1.245</p>
        </div>
        <div class="bg-dark-700 p-4 rounded-lg border border-dark-600 hover:border-purple-500 transition-colors">
          <p class="text-sm text-gray-400">Clientes Novos</p>
          <p class="text-2xl font-bold">7</p>
        </div>
        <div class="bg-dark-700 p-4 rounded-lg border border-dark-600 hover:border-yellow-500 transition-colors">
          <p class="text-sm text-gray-400">Avalia칞칚o</p>
          <p class="text-2xl font-bold">4.7/5</p>
        </div>
      </div>

      <!-- Gr치fico -->
      <div class="bg-dark-700 p-4 rounded-lg border border-dark-600 mb-6">
        <h3 class="text-lg font-semibold mb-3">Pedidos nos 칰ltimos 7 dias</h3>
        <canvas id="graficoPedidos" height="200"></canvas>
      </div>

      <!-- Tabela de Pedidos -->
      <div class="bg-dark-700 rounded-lg border border-dark-600 overflow-hidden">
        <div class="px-4 py-3 border-b border-dark-600 flex justify-between items-center">
          <h3 class="font-semibold">칔ltimos Pedidos</h3>
          <a href="#" class="text-sm text-blue-400 hover:text-blue-300 hover:underline">Ver todos</a>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-dark-600">
            <thead class="bg-dark-800">
              <tr>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400">Cliente</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400">Produtos</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400">Valor</th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-400">Status</th>
              </tr>
            </thead>
            <tbody id="tabela-pedidos" class="divide-y divide-dark-600">
              <tr><td colspan="4" class="px-4 py-4 text-center text-gray-500">Carregando pedidos...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <script>
    // Dados do gr치fico
    const dadosPedidos = {
      dias: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S치b', 'Dom'],
      valores: [12, 19, 8, 15, 22, 18, 24]
    };

    // Inicializar gr치fico
    document.addEventListener('DOMContentLoaded', function() {
      // Gr치fico de Pedidos
      const ctx = document.getElementById('graficoPedidos').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: dadosPedidos.dias,
          datasets: [{
            label: 'Pedidos',
            data: dadosPedidos.valores,
            backgroundColor: '#3b82f6',
            borderRadius: 4,
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                color: '#3a3a3a',
                drawBorder: false
              },
              ticks: {
                color: '#9ca3af'
              }
            },
            x: {
              grid: {
                display: false,
                drawBorder: false
              },
              ticks: {
                color: '#9ca3af'
              }
            }
          }
        }
      });

      // Carregar dados da API para a tabela
      fetch('https://tcc-uh9r.onrender.com/pedido')
        .then(res => res.json())
        .then(pedidos => {
          const tbody = document.getElementById('tabela-pedidos');
          tbody.innerHTML = '';

          if (!pedidos.length) {
            tbody.innerHTML = `<tr><td colspan="4" class="px-4 py-4 text-center text-gray-500">Nenhum pedido encontrado</td></tr>`;
            return;
          }

          // Pegar apenas os 칰ltimos 5 pedidos para exibir
          const ultimosPedidos = pedidos.slice(0, 5);

          ultimosPedidos.forEach(p => {
            let itens = p.itens;
            try {
              itens = JSON.parse(p.itens);
            } catch {
              itens = [{ name: itens }];
            }

            const nomesProdutos = itens.map(i => i.name).join(', ');
            const valorTotal = itens.reduce((total, item) => total + (item.price || 0), 0);
            
            // Status simplificado
            const status = p.status || 'Recebido';
            const statusClass = status === 'Entregue' ? 'bg-green-900 text-green-300' : 
                              status === 'Cancelado' ? 'bg-red-900 text-red-300' : 'bg-blue-900 text-blue-300';

            tbody.innerHTML += `
              <tr class="hover:bg-dark-600 transition-colors">
                <td class="px-4 py-3 whitespace-nowrap">
                  <div class="font-medium">${p.cliente_nome || 'Cliente n칚o informado'}</div>
                </td>
                <td class="px-4 py-3 text-sm text-gray-400">${nomesProdutos}</td>
                <td class="px-4 py-3 font-medium">R$ ${valorTotal.toFixed(2)}</td>
                <td class="px-4 py-3 whitespace-nowrap">
                  <span class="px-2 py-1 text-xs rounded-full ${statusClass}">${status}</span>
                </td>
              </tr>
            `;
          });
        })
        .catch(err => {
          const tbody = document.getElementById('tabela-pedidos');
          tbody.innerHTML = `<tr><td colspan="4" class="px-4 py-4 text-center text-red-400">Erro ao carregar pedidos</td></tr>`;
          console.error('Erro:', err);
        });
    });
  </script>

</body>
</html>