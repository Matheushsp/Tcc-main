<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <meta property="og:type" content="website"/>
  <meta property="og:title" content="Card√°pio - Big John Cookies"/>
  <meta property="og:image" content="https://projeto-cardapio-wine.vercel.app/assets/hamb-1.png"/>
  <meta property="og:description" content="Confira nosso delicioso card√°pio de cookies!" />
  <meta property="og:site_name" content="Big John Cookies" /> 
  <link rel="stylesheet" href="./styles/output.css" />
  <link rel="stylesheet" href="./styles/style.css" />
  <title>Card√°pio - Big John Cookies</title>
  <style>
    /* Estilos para o modal do carrinho */
    #cart-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding: 10px;
      border-bottom: 1px solid #ddd;
    }

    .cart-item-details {
      flex-grow: 1;
      margin-right: 10px;
    }

    .cart-item-name {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .cart-item-quantity {
      color: #666;
    }

    .cart-item-price {
      font-weight: bold;
      color: #333;
    }

    .remove-from-cart-btn {
      background-color: #ff4d4d;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }

    .hidden {
      display: none;
    }

    /* Estilos para o bot√£o do carrinho */
    #cart-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: red;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      z-index: 1001;
    }
  </style>
</head>
<body>
  <!-- Hotbar de Navega√ß√£o -->
  <nav class="hotbar">
    <div class="container">
      <a href="#" class="logo">Cookies</a>
      <div class="nav-links">
        <a href="index.html" class="nav-link">Home</a>
      </div>
    </div>
  </nav>

  <!-- Conte√∫do Principal -->
  <div class="container">
    <h1 class="text-4xl mt-4 mb-2 font-bold text-center">Card√°pio</h1>

    <!-- Itens do Card√°pio -->
    <div class="menu-grid">
      <!-- Item 1 -->
      <div class="menu-item">
        <img src="./assets/cookies1.jpg" alt="Cookie de Chocolate">
        <div class="menu-item-content">
          <h3>Cookie de Chocolate</h3>
          <p>Delicioso cookie com gotas de chocolate meio amargo.</p>
          <p class="price">R$ 5,00</p>
          <button class="add-to-cart-btn" data-name="Cookie de Chocolate" data-price="5.00">Adicionar ao Carrinho</button>
        </div>
      </div>

      <!-- Item 2 -->
      <div class="menu-item">
        <img src="./assets/cookies2.jpg" alt="Cookie de Baunilha">
        <div class="menu-item-content">
          <h3>Cookie de Baunilha</h3>
          <p>Cookie suave com ess√™ncia de baunilha e confeitos coloridos.</p>
          <p class="price">R$ 5,00</p>
          <button class="add-to-cart-btn" data-name="Cookie de Baunilha" data-price="5.00">Adicionar ao Carrinho</button>
        </div>
      </div>

      <!-- Item 3 -->
      <div class="menu-item">
        <img src="./assets/cookies3.jpg" alt="Cookie de Nutella">
        <div class="menu-item-content">
          <h3>Cookie de Nutella</h3>
          <p>Cookie recheado com Nutella e peda√ßos de avel√£.</p>
          <p class="price">R$ 6,00</p>
          <button class="add-to-cart-btn" data-name="Cookie de Nutella" data-price="6.00">Adicionar ao Carrinho</button>
        </div>
      </div>

      <!-- Item 4 -->
      <div class="menu-item">
        <img src="./assets/cookies4.jpg" alt="Cookie de Red Velvet">
        <div class="menu-item-content">
          <h3>Cookie de Red Velvet</h3>
          <p>Cookie com massa vermelha e gotas de chocolate branco.</p>
          <p class="price">R$ 6,00</p>
          <button class="add-to-cart-btn" data-name="Cookie de Red Velvet" data-price="6.00">Adicionar ao Carrinho</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal do Carrinho -->
  <div id="cart-modal" class="hidden">
    <div class="modal-content">
      <h2 class="text-center font-bold text-2xl mb-2">Meu Carrinho</h2>
      <div id="cart-items"></div>
      <p class="font-bold">Total: <span id="cart-total">R$ 0,00</span></p>
      <input id="cliente-nome" type="text" placeholder="Seu nome" class="border p-2 w-full mb-2 rounded" />
      <input id="cliente-telefone" type="tel" placeholder="Seu telefone" class="border p-2 w-full mb-4 rounded" />
      <p class="font-bold mt-4">Endere√ßo de entrega:</p>
      <input 
        type="text"
        placeholder="Digite seu endere√ßo completo..."
        id="address"
        class="w-full border-2 p-1 rounded my-1"
      />
      <p class="text-red-500 hidden" id="address-warn">Digite seu endere√ßo completo!</p>
      <div class="flex items-center justify-between mt-5 w-full">
        <button id="close-modal-btn">Fechar</button>
        <button id="checkout-btn" class="bg-green-500 text-white px-4 py-1 rounded">Finalizar Pedido</button>
      </div>
    </div>
  </div>

  <!-- Bot√£o do Carrinho no Footer -->
  <button id="cart-btn">Carrinho (<span id="cart-count">0</span>)</button>

  <!-- Scripts -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <script>
    // Vari√°veis globais
    let cart = [];
    let total = 0;

    // Fun√ß√£o para adicionar item ao carrinho
    function addToCart(name, price) {
      const existingItem = cart.find(item => item.name === name);

      if (existingItem) {
        existingItem.quantity += 1;
      } else {
        cart.push({ name, price: parseFloat(price), quantity: 1 });
      }

      updateCartModal();
    }

    // Fun√ß√£o para atualizar o carrinho
    function updateCartModal() {
      const cartItems = document.getElementById('cart-items');
      const cartTotal = document.getElementById('cart-total');
      const cartCount = document.getElementById('cart-count');

      cartItems.innerHTML = '';
      total = 0;

      cart.forEach(item => {
        const itemElement = document.createElement('div');
        itemElement.classList.add('cart-item');
        itemElement.innerHTML = `
          <div class="cart-item-details">
            <p class="cart-item-name">${item.name}</p>
            <p class="cart-item-quantity">Qtd: ${item.quantity}</p>
          </div>
          <p class="cart-item-price">R$ ${(item.price * item.quantity).toFixed(2)}</p>
          <button class="remove-from-cart-btn" data-name="${item.name}">Remover</button>
        `;

        total += item.price * item.quantity;
        cartItems.appendChild(itemElement);
      });

      cartTotal.textContent = total.toLocaleString('pt-BR', {
        style: 'currency',
        currency: 'BRL',
      });

      cartCount.textContent = cart.length;
    }

    // Fun√ß√£o para remover item do carrinho
    function removeItemCart(name) {
      const index = cart.findIndex(item => item.name === name);

      if (index !== -1) {
        const item = cart[index];

        if (item.quantity > 1) {
          item.quantity -= 1;
        } else {
          cart.splice(index, 1);
        }

        updateCartModal();
      }
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', () => {
      const addToCartButtons = document.querySelectorAll('.add-to-cart-btn');
      const cartBtn = document.getElementById('cart-btn');
      const closeModalBtn = document.getElementById('close-modal-btn');
      const checkoutBtn = document.getElementById('checkout-btn');
      const cartItemsContainer = document.getElementById('cart-items');
      const addressInput = document.getElementById('address');
      const addressWarn = document.getElementById('address-warn');

      // Adicionar item ao carrinho
      addToCartButtons.forEach(button => {
        button.addEventListener('click', () => {
          const name = button.getAttribute('data-name');
          const price = button.getAttribute('data-price');
          addToCart(name, price);
        });
      });

      // Abrir modal do carrinho
      cartBtn.addEventListener('click', () => {
        updateCartModal();
        document.getElementById('cart-modal').classList.remove('hidden');
      });

      // Fechar modal do carrinho
      closeModalBtn.addEventListener('click', () => {
        document.getElementById('cart-modal').classList.add('hidden');
      });

      // Remover item do carrinho
      cartItemsContainer.addEventListener('click', event => {
        if (event.target.classList.contains('remove-from-cart-btn')) {
          const name = event.target.getAttribute('data-name');
          removeItemCart(name);
        }
      });

      // Finalizar pedido
      checkoutBtn.addEventListener('click', async () => {
  if (cart.length === 0) return;

  const clienteNome = document.getElementById('cliente-nome').value;
  const clienteTelefone = document.getElementById('cliente-telefone').value;
  const endereco = addressInput.value;

  if (!endereco || !clienteNome || !clienteTelefone) {
    addressWarn.classList.remove('hidden');
    addressInput.classList.add('border-red-500');
    return;
  }

  const pedido = {
    cliente_nome: clienteNome,
    cliente_telefone: clienteTelefone,
    itens: cart,
    total: total,
    endereco: endereco
  };

  try {
    const response = await fetch('http://localhost:3000/pedido', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(pedido)
    });

    if (!response.ok) throw new Error('Erro ao salvar pedido.');

    // Sucesso ‚Äî abrir WhatsApp
    const itensMsg = cart.map(item =>
      `${item.name} (x${item.quantity}) - R$${item.price.toFixed(2)}`
    ).join('\n');

    const msg = encodeURIComponent(
      `üç™ Novo Pedido Big John Cookies:\n\n` +
      `üë§ Nome: ${clienteNome}\n` +
      `üìû Telefone: ${clienteTelefone}\n` +
      `üì¶ Pedido:\n${itensMsg}\n\n` +
      `üìç Endere√ßo: ${endereco}\n` +
      `üí∞ Total: R$ ${total.toFixed(2)}`
    );

    const phone = '19986058820'; // Seu n√∫mero com DDD
    window.open(`https://wa.me/${phone}?text=${msg}`, '_blank');

    // Resetar carrinho
    cart = [];
    updateCartModal();
    document.getElementById('cart-modal').classList.add('hidden');
  } catch (error) {
    alert('Erro ao enviar pedido. Tente novamente.');
    console.error(error);
  }
});
      
    });
  </script>
</body>
</html>